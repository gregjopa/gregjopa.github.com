{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/2014/02/testing-and-code-coverage-with-node-js-apps","result":{"data":{"post":{"__typename":"MdxPost","slug":"/2014/02/testing-and-code-coverage-with-node-js-apps","title":"Testing and Code Coverage with Node.js Apps","date":"02.24.2014","tags":[{"name":"JavaScript","slug":"java-script"},{"name":"Node.js","slug":"node-js"},{"name":"Testing","slug":"testing"}],"description":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Testing and Code Coverage with Node.js Apps\",\n  \"slug\": \"2014/02/testing-and-code-coverage-with-node-js-apps\",\n  \"date\": \"2014-02-24T10:15:12.000Z\",\n  \"comments\": true,\n  \"tags\": [\"JavaScript\", \"Node.js\", \"Testing\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"546px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"64.16666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAD/9oADAMBAAIQAxAAAAHWUxaKf//EABoQAAICAwAAAAAAAAAAAAAAAAABAhAREiL/2gAIAQEAAQUCxeqY4xOT/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8Bqv/EABURAQEAAAAAAAAAAAAAAAAAAAAT/9oACAECAQE/AZpv/8QAFhABAQEAAAAAAAAAAAAAAAAAADER/9oACAEBAAY/AqqtRH//xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhMXGR8f/aAAgBAQABPyFRsYSFQbVLPJBt2T1P/9oADAMBAAIAAwAAABAvD//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ELP/xAAXEQEBAQEAAAAAAAAAAAAAAAABAFFx/9oACAECAQE/EE5cF//EABsQAQADAQADAAAAAAAAAAAAAAEAESFBMVFx/9oACAEBAAE/EByV0dYtnR7lGIYCWoNEchKqDnnKun65/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Istanbul Code Coverage\",\n    \"title\": \"Istanbul Code Coverage\",\n    \"src\": \"/static/725f87229ea90851873b5b6bec94fa80/88627/istanbul_code_coverage_banner_screenshot.jpg\",\n    \"srcSet\": [\"/static/725f87229ea90851873b5b6bec94fa80/46946/istanbul_code_coverage_banner_screenshot.jpg 240w\", \"/static/725f87229ea90851873b5b6bec94fa80/55489/istanbul_code_coverage_banner_screenshot.jpg 480w\", \"/static/725f87229ea90851873b5b6bec94fa80/88627/istanbul_code_coverage_banner_screenshot.jpg 546w\"],\n    \"sizes\": \"(max-width: 546px) 100vw, 546px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"Developing maintainable apps requires having good test coverage. The JavaScript community has created some awesome tools that make it easy to implement workflows for code linting, unit/integration testing, and measuring code coverage. This post focuses on how to develop tests with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://mochajs.org/\"\n  }), \"Mocha\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/visionmedia/supertest\"\n  }), \"Supertest\"), \" and how to generate code coverage reports with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://gotwarlost.github.io/istanbul/\"\n  }), \"Istanbul\"), \".\"), mdx(DemoButtonGroup, {\n    downloadLink: \"https://github.com/gregjopa/express-app-testing-demo\",\n    demoLink: \"https://express-app-testing-demo.herokuapp.com/\",\n    mdxType: \"DemoButtonGroup\"\n  }), mdx(\"h2\", null, \"Demo App Functionality\"), mdx(\"p\", null, \"I created a simple node.js app to demonstrate testing and code coverage. The source code for this app is on github here: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gregjopa/express-app-testing-demo\"\n  }), \"https://github.com/gregjopa/express-app-testing-demo\"), \". This app uses \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.flickr.com/services/feeds/docs/photos_public/\"\n  }), \"Flickr's public feed api\"), \" to search public photos. It has basic form functionality for entering search terms and based on that form input it retrieves photos. All logic in this app is handled on the server-side and no client-side JavaScript is used. This app is hosted on heroku here: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://express-app-testing-demo.herokuapp.com/\"\n  }), \"https://express-app-testing-demo.herokuapp.com/\"), \".\"), mdx(\"p\", null, \"This app uses the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://expressjs.com/\"\n  }), \"express.js framework\"), \" along with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/request/request\"\n  }), \"request\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/tj/ejs\"\n  }), \"ejs\"), \". \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://gruntjs.com/\"\n  }), \"Grunt\"), \" is used for implementing workflows for code linting, testing, and code coverage.\"), mdx(\"h2\", null, \"Preparing a Test Plan\"), mdx(\"p\", null, \"I recommend designing a test plan at the same time you design your application's functionality. Think about the different components of the app and how they can break. For example, if the app depends on an external api service assume that the api service can go offline or return invalid data. If the app accepts user input assume that the user input can be invalid and possibly dangerous. In my opinion the purpose of the test plan is to be an outline for developers as they write tests. The test plan should not be documentation for the tests since it can easily become out-of-date. Instead, your tests should be self-describing. For example, here is a simple test plan for this photo searching app:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Form input - if the user enters valid search terms the app should work.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Form input - if the user enters invalid search terms the app should return an error.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"API data - if the data returned from the flickr api is valid the app should work.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"API data - if the data returned from the flickr api is invalid the app should return an error.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"API data - if the flickr api returns zero results an alert should be returned to notify the user.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Route - if the app is working correctly a 200 http status code should be returned.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Route - if there is a server error a 500 http status code should be returned.\")), mdx(\"h2\", null, \"Tests\"), mdx(\"p\", null, \"There are different types of tests that can be implemented when testing web applications:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Unit tests - isolate a small block of code and test it's intention\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Integration tests - test how different components of an application work together\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Service tests - isolate a service to see if it's working correctly (ex: api endpoint, database)\")), mdx(\"p\", null, \"My test app includes unit tests, integration tests, and api tests. I'm using the assertion library \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/tj/should.js\"\n  }), \"should.js\"), \" for clean and readable tests.\"), mdx(\"h3\", null, \"Unit Tests\"), mdx(\"p\", null, \"Form validation methods are a good example for unit testing. Typically form validation methods take in a single input parameter and use a regular expression to see the input value is valid or not.\"), mdx(\"p\", null, \"Here's a form validation method with a couple Mocha unit tests:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"var isValidCommaDelimitedList = function (value) {\\n  // allow letters, commas, and spaces\\n  var commaDelimitedListRegEx = /^[A-Za-z,\\\\s]+$/;\\n  return commaDelimitedListRegEx.test(value);\\n};\\n\\n// tests\\ndescribe('isValidCommaDelimitedList(value)', function () {\\n\\n  it('should return true for valid list of search terms', function () {\\n    var tags = 'california, sunset, red';\\n    formValidator.isValidCommaDelimitedList(tags).should.be.true;\\n  });\\n\\n  it('should return false for search term containing numbers', function () {\\n    var tags = 'dogs123';\\n    formValidator.isValidCommaDelimitedList(tags).should.be.false;\\n  });\\n\\n});\\n\")), mdx(\"h3\", null, \"Integration Tests for Routes\"), mdx(\"p\", null, \"Node web application routes can be tested using the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/visionmedia/supertest\"\n  }), \"Supertest\"), \" library. Supertest can start up a node app, make http requests to routes, and run assertions on http responses. It can pass parameters to routes and run assertions on things like the response http status code, content type, and execute regular expressions against the response body.\"), mdx(\"p\", null, \"If your routes depend on accessing a database or api I recommend mocking that data for your route tests. This way your database or api won't influence your route test results. I'm using the node module \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/node-nock/nock\"\n  }), \"nock\"), \" in my project to mock the data returned by the flickr public feed api.\"), mdx(\"p\", null, \"Here are some route tests:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// route\\napp.get('/', function (req, res) {\\n  var tags = req.param('tags');\\n  var tagmode = req.param('tagmode');\\n  // more route logic here ...\\n});\\n\\n// tests\\ndescribe('index route', function () {\\n\\n  it('should respond with a 200 with invalid query parameters', function (done) {\\n    // invalid query parameters will return html containing an alert message\\n    request(app)\\n      .get('/?tags=california123&tagmode=all')\\n      .expect('Content-Type', /html/)\\n      .expect(200)\\n      .expect(/<div class=\\\"alert alert-danger\\\">/, done);\\n  });\\n\\n  it('should respond with a 500 error due to bad jsonp data', function (done) {\\n\\n    // mock the flickr public feed api endpoint with invalid jsonp data that's missing parentheses\\n    var jsonpData = 'jsonFlickrFeed{\\\"items\\\": [' +\\n      '{ \\\"title\\\": \\\"Boating\\\",' +\\n        '\\\"media\\\": {\\\"m\\\":\\\"http://farm4.staticflickr.com/3727/12608622365_9e9b8b377d_m.jpg\\\"} },' +\\n      '{ \\\"title\\\": \\\"Signs\\\",' +\\n        '\\\"media\\\": {\\\"m\\\":\\\"http://farm8.staticflickr.com/7446/12608714423_efaf73400c_m.jpg\\\"} }' +\\n      ']}';\\n\\n    var flickrFeedApi = nock('http://api.flickr.com')\\n      .get('/services/feeds/photos_public.gne?tags=california&tagmode=all&format=json')\\n      .reply(200, jsonpData);\\n\\n    request(app)\\n      .get('/?tags=california&tagmode=all')\\n      .expect(500, done);\\n\\n  });\\n\\n});\\n\")), mdx(\"h3\", null, \"API Tests\"), mdx(\"p\", null, \"It can be helpful to have tests for an external service used by your app. If you rely on external services and you have tests for them then when your app breaks it easier to determine if the problem is with your code base or the external service.\"), mdx(\"p\", null, \"Mocha makes it easily to asynchronously test an api endpoint. Here's a test I have for flickr's public feed api:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// flickr public feed api\\nfunction API (params) {\\n  this.uri = 'http://api.flickr.com/services/feeds/photos_public.gne';\\n  this.qs = {\\n    tags: params.tags || '',\\n    tagmode: params.tagmode || '',\\n    format: params.format || 'json'\\n  };\\n}\\n\\n// test\\ndescribe('flickr public feed api', function () {\\n\\n  it('should return expected json format', function (done) {\\n\\n    var apiTest = new API({\\n      tags: 'california',\\n      tagmode: 'all'\\n    });\\n\\n    request.get(apiTest, function (error, response, body) {\\n      response.statusCode.should.equal(200, 'Invalid http status code');\\n\\n      var json = jsonpHelper.parseJSONP(body);\\n      json.should.have.property('items');\\n\\n      var photos = json.items;\\n      photos.should.be.an.instanceOf(Array);\\n\\n      photos.forEach(function (photo) {\\n        photo.should.have.keys(\\n          'title',\\n          'link',\\n          'media',\\n          'date_taken',\\n          'description',\\n          'published',\\n          'author',\\n          'author_id',\\n          'tags'\\n        );\\n      });\\n\\n      done();\\n    });\\n\\n  });\\n\\n});\\n\")), mdx(\"h2\", null, \"Code Coverage\"), mdx(\"p\", null, \"Code coverage tools analyze an application's source code and test suite and then identify code that's missing tests. Code coverage provides a way to measure the quality of your application.\"), mdx(\"h3\", null, \"Istanbul\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://gotwarlost.github.io/istanbul/\"\n  }), \"Istanbul\"), \" is a JavaScript code coverage tool that provides instrumentation and reporting. It has an html reporting option and also an lcov reporting option that can be used with the code quality tool \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.sonarqube.org/\"\n  }), \"SonarQube\"), \".\"), mdx(\"p\", null, \"Here's a screenshot of the Istanbul html reporter for a module with zero tests:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"898px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.41666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4ElEQVQoz3WPzU/UQBiH+5d6Vm8bV/EgGOPFj5MmEDwAGg6YaAQiBuKGiIkmosKy/dx2uzvdTnfbznSmX9Nl2+22llWMEHzyZPLLm/lN5uXi7hxp15F8l6pzjlgb8nV4cssWalN7vnAelE51LvwOpVuF+2fhXA4JN+DPm4B/6amPhkfXoPAE66uBcp2o94j5NoULWH3oGRsjUKedeQaXSrtW2ndK+3Ylh/WlvvbMNlc8uGb3lhlez8KNLFw/dRZTtDi2n46d5awaopXUXZvgV7m3+lcunxbDwwba3wW7DXnrnbK1KW1ug7098P5Ff/vx4OB5nrhlWRZFUc4o/pHLssmQP6atpi9piD/BAk9aP3Dziy9+i9pyFsTnlSvg0jTtCV8d4ZioPVcSGNCY0qBHb8Lm67ElFJOra3/KCUuA+B21RV83vI6GVAXrXV9v+8I+FXao9AGJO2ygjBDOE3a5zFhi8IdEbiUAxr0O1dRA70S6FEifI/kgED/h5sdAbQYdLfPJpRW4OGaqpQC3r/VAW+8OXYT9gEQxZeOZWZJN//d1LgxDC0LkOv0KwxhAaJ1pYoR86nkYnY6SYppP85kX4QghCCFKaRxFcRwHQWCafWgOTMOqXrMsyzRNMKO66V/kF2U2RgvI4AkTAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Istanbul Bad Test Coverage\",\n    \"title\": \"Istanbul Bad Test Coverage\",\n    \"src\": \"/static/137a96aa7a25a264ee273acafcb0d260/27257/istanbul_bad_test_coverage_screenshot.png\",\n    \"srcSet\": [\"/static/137a96aa7a25a264ee273acafcb0d260/5243c/istanbul_bad_test_coverage_screenshot.png 240w\", \"/static/137a96aa7a25a264ee273acafcb0d260/ab158/istanbul_bad_test_coverage_screenshot.png 480w\", \"/static/137a96aa7a25a264ee273acafcb0d260/27257/istanbul_bad_test_coverage_screenshot.png 898w\"],\n    \"sizes\": \"(max-width: 898px) 100vw, 898px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"After adding tests for all methods in this module the html report will look like this:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"898px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.41666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAByUlEQVQoz31QXXPSUBC9/9sH+1JtO31wKr7Vaqc4UmGs1NKxfiCdlDi0pTglhvCZ3HxBCMm9SUiAJAQXeXFUPHPuzpnZu3t2F+Uquxl2O3O1c1zeSV9upkuPjr5A3Dyr751zzwr11Bm3V+BSoFcCCKkV0WHp4YvPGx8rxx+qLw+KD7LMk8vau3z16atvGxd3R6xwmq0+Pr95XuZPs7db+dtUkU+f1Lfz9V0gurg7fF/Zh3+fvqcL1wdff7xmO2/L3VypkWGaOaaVY9pvrlo5tnMCgmll2e4yuyKaz5OaWOyoDQUP+AbfFJo8z2NJkrW+0tf6ph7Po8UaoCiKBLGmG4rrBMPh0DRHtkUhUoe4nhvF4WI90GwW3vdYedAj9tgwDD8Y+9MZIY7j0Gk8TRb/A/LHPte90QzsUN+ybNM0LcukhFLiEWITQkajke/7k8kkjuO/iwOue60NsT8OXde1LAsKXNej1AVz0LALpRR0GP65AvJcr40bstprt9pNQdD1PlhBC9te2kJZEATJmumRQx1FVQxjgLGMMVaX0OAtL2fb0AgGTpJk/i8gMIEbg4kHM3gwLZVlWZV1WVKlX72gkySKkiitNvodPwF1wUQUkl6YVAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Istanbul Good Test Coverage\",\n    \"title\": \"Istanbul Good Test Coverage\",\n    \"src\": \"/static/fb128084a578ae6225fa2e45ef010542/27257/istanbul_good_test_coverage_screenshot.png\",\n    \"srcSet\": [\"/static/fb128084a578ae6225fa2e45ef010542/5243c/istanbul_good_test_coverage_screenshot.png 240w\", \"/static/fb128084a578ae6225fa2e45ef010542/ab158/istanbul_good_test_coverage_screenshot.png 480w\", \"/static/fb128084a578ae6225fa2e45ef010542/27257/istanbul_good_test_coverage_screenshot.png 898w\"],\n    \"sizes\": \"(max-width: 898px) 100vw, 898px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"Istanbul can be installed as a global node module and used from the command line. Or you can use Istanbul as a local module with Grunt which is the approach I took with my test app. I describe configuring Istanbul with Grunt in the following \\\"Grunt Workflow\\\" section.\"), mdx(\"h3\", null, \"SonarQube\"), mdx(\"p\", null, \"SonarQube is a code quality tool that provides code coverage reporting as well as many other features. It's possible to integrate a JavaScript project into Sonar by using Istanbul's instrumentation. Istanbul can output an lcov.info file that can be used by the sonar-runner. The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.sonarqube.org/display/SONARQUBE51/Installing+and+Configuring+SonarQube+Runner\"\n  }), \"sonar-runner\"), \" works by reading a config file at the root of your project, performing some analysis, and then uploading statistics to the SonarQube server. Here is a link to my test project's sonar config file: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gregjopa/express-app-testing-demo/blob/master/sonar-project.properties\"\n  }), \"https://github.com/gregjopa/express-app-testing-demo/blob/master/sonar-project.properties\")), mdx(\"p\", null, \"Sonar stores code coverage statistics about your application in a database which makes it possible to compare different versions of your application to see if your code coverage is getting better or worse.\"), mdx(\"p\", null, \"Here's a screenshot of this test project in SonarQube:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"935px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"62.083333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABnElEQVQoz4VS207CQBDdL0ZD0NgEiUqiL7z7D8qjRo0+oKgRX9QiLYaLqd3eoNBtu6VXWoc2VuL1PGwmM3NmzpwsKpcrzMZ6mdlYK5V2qtXKZmVra3tvb5dhmEKhsJJi9QPFYrFWq7VadzzPNxoNdMKNDx6U/VvMSlaSRK7rAVzXdRwnjuPkJ4Rh6Ps+vOiiIx49Cqc9k5MMYdi3bBvKJjEBGRn6LMvKaJHvyeKbTWkQBAvydVe8eBq0REvQbfwmGMSEJlgryzJ0QAyvoiiGYSwGeTOu0ybExBhDBjW7+Pieu+pPXnWqjzRnNoOmOJ4D4hRRFBFiwPLFtiikDoVMJgQ1efGyK91jZ6ARVcbzb2fCFJ7jh8M+HAJjs2Q2F930tLOHwfnLGDZbZAqG5bV8s6qomqaOxpoX0OW5SJw6bF/oaUSZEJ7nwjDKyHnHZxwnX/xHeQQn2anVy8IyJL8AQQXcWTgZ+OAwtSl0U0rnaRI0Z8HP5FwY+NF+bvuB5/tBvX7IsiwIgQ/zDzl3FXjpB4pELEkY67oOP+QP2e8Qp5aMR6nLfwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"SonarQube Code Analysis\",\n    \"title\": \"SonarQube Code Analysis\",\n    \"src\": \"/static/681ab9a86784bb15be92171355810c86/724ba/sonarqube_code_analysis_screenshot.png\",\n    \"srcSet\": [\"/static/681ab9a86784bb15be92171355810c86/5243c/sonarqube_code_analysis_screenshot.png 240w\", \"/static/681ab9a86784bb15be92171355810c86/ab158/sonarqube_code_analysis_screenshot.png 480w\", \"/static/681ab9a86784bb15be92171355810c86/724ba/sonarqube_code_analysis_screenshot.png 935w\"],\n    \"sizes\": \"(max-width: 935px) 100vw, 935px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h2\", null, \"Grunt Workflow\"), mdx(\"p\", null, \"Grunt can be used to configure Mocha and Istanbul so you don't need to worry about installing them as global modules. Here are the grunt plugins I'm using for Mocha and Instanbul:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/pghalliday/grunt-mocha-test\"\n  }), \"grunt-mocha-test\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/taichi/grunt-istanbul\"\n  }), \"grunt-istanbul\"))), mdx(\"p\", null, \"The grunt-istanbul plugin is easy to use with Mocha or any other testing framework. To configure the grunt-istanbul plugin setup a task to run the following:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Instrument your source code\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Run your test suite against your instrumented source code\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Store your coverage results\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Make the report\")), mdx(\"p\", null, \"I follow these steps in my test project's Gruntfile here:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gregjopa/express-app-testing-demo/blob/master/Gruntfile.js\"\n  }), \"https://github.com/gregjopa/express-app-testing-demo/blob/master/Gruntfile.js\")), mdx(\"p\", null, \"When I normally run my test suite I want it to point directly at my source code. But when I run the Istanbul code coverage task I want my test suite to point at the instrumented source code. To accomplish this I created a require_helper module. This require_helper module uses an environment variable to determine which path to use for loading the source code to run the tests against. When I execute my code coverage grunt task I set the environment variable using the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/jsoverson/grunt-env\"\n  }), \"grunt-env\"), \" plugin to point to the instrumented source code. Here's some example code to demonstrate how this requireHelper module works:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// require_helper.js\\nmodule.exports = function (path) {\\n  return require((process.env.APP_DIR_FOR_CODE_COVERAGE || '../app/') + path);\\n};\\n\\n// using requireHelper in a test\\nvar requireHelper = require('../require_helper');\\nvar formValidator = requireHelper('form_validator');\\n\")), mdx(\"h2\", null, \"Conclusion\"), mdx(\"p\", null, \"Code coverage is easy to setup using Grunt and Istanbul. Having statistics like code coverage will make your application easier to maintain and update. But code coverage is not perfect so make sure to still manually review your source code to see if you have tests for every use case. For my next post I plan on writing about testing and code coverage for client-side JavaScript apps.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Developing maintainable apps requires having good test coverage. The JavaScript community has created some awesome tools that make it easy…","timeToRead":5,"banner":null}},"pageContext":{"slug":"/2014/02/testing-and-code-coverage-with-node-js-apps","formatString":"MM.DD.YYYY"}}}